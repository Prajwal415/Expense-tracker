<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard — Recommendations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <style>
    /* Small self-contained overrides so you don't need to change style.css */
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#fafafa; color:#111; }
    .container{ max-width:980px; margin:22px auto; padding:18px; }
    .card{ background:white; padding:14px; border-radius:10px; box-shadow: 0 6px 16px rgba(0,0,0,0.06); margin-bottom:12px; }
    .link{ color:#444; text-decoration:none; cursor:pointer; margin-right:8px; }
    .section-title{ margin-top:14px; margin-bottom:8px; color:#333; font-size:1.05rem; }
    .small{ color:#666; font-size:0.9rem; }

    /* Light yellow button style applied to all buttons and .link-like actions */
    button, .link, .app-btn, .secondary, #applyCustomBtn {
      background: #d8c514cd; /* light yellow */
      border: 1px solid rgba(0,0,0,0.06);
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    button:hover, .link:hover { filter: brightness(0.98); }

    /* Recommendation plans side-by-side */
    .plans {
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:stretch;
      margin-bottom:8px;
    }
    .plan-card {
      flex:1 1 260px; /* grow, shrink, basis */
      min-width:220px;
    }

    /* Custom plan sliders styling (simple) */
    input[type="range"]{ width:100%; margin-top:6px; }

    /* App boxes grid layout */
    .apps {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:12px;
    }
    .app-box{ display:flex; flex-direction:column; gap:8px; }

    /* Inline salary editor modal-like box */
    .salary-editor {
      position: fixed;
      left: 50%;
      top: 40%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 14px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      z-index: 9999;
      width: 320px;
      display: none; /* toggled via JS */
    }
    .salary-editor h4{ margin:0 0 8px 0; }
    .overlay {
      position: fixed;
      inset:0;
      background: rgba(0,0,0,0.35);
      z-index: 9998;
      display: none;
    }
    .top-actions { margin-bottom:12px; }
    .small-input { width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; font-size:1rem; margin-top:6px; }
  </style>
</head>
<body>

<script>
  // unified auth check — uses same key as index.html
  const CURRENT_KEY = 'currentUser';
  if (!localStorage.getItem(CURRENT_KEY)) {
    // Not signed in — redirect to the combined auth page (index.html)
    window.location.href = 'index.html';
  }
</script>

<div class="container">
  <h2>Dashboard</h2>

  <div class="top-actions" style="margin-bottom:12px">
    <!-- Change Salary opens inline editor on same page -->
    <a class="link" href="javascript:void(0)" onclick="openSalaryEditor()">Change Salary</a> |
    <!-- Add Expense must go to add-expense.html -->
    <a class="link" href="add-expense.html">Add Expense</a> |
    <!-- Logout goes to index.html -->
    <span class="link" onclick="logout()">Logout</span>
  </div>

  <!-- show saved salary -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700">Saved Salary</div>
        <div id="salaryDisplay" class="small">—</div>
      </div>
      <div>
        <!-- Edit Salary button now opens inline editor (same page) -->
        <button onclick="openSalaryEditor()" class="secondary">Edit Salary</button>
      </div>
    </div>
  </div>

  <!-- Recommendations presets (side by side) -->
  <h3 class="section-title">Recommendation Plans</h3>

  <div class="plans">
    <div class="card plan-card">
      <div style="font-weight:700">Balanced Plan</div>
      <div class="small" style="margin-top:6px">Invest 30% • Save 20% • Essentials 50%</div>
      <div style="margin-top:8px">
        <button onclick="applyPreset(30,20,50)">Use Balanced</button>
      </div>
    </div>

    <div class="card plan-card">
      <div style="font-weight:700">Conservative Plan</div>
      <div class="small" style="margin-top:6px">Invest 15% • Save 35% • Essentials 50%</div>
      <div style="margin-top:8px">
        <button onclick="applyPreset(15,35,50)">Use Conservative</button>
      </div>
    </div>

    <div class="card plan-card">
      <div style="font-weight:700">Aggressive Plan</div>
      <div class="small" style="margin-top:6px">Invest 45% • Save 10% • Essentials 45%</div>
      <div style="margin-top:8px">
        <button onclick="applyPreset(45,10,45)">Use Aggressive</button>
      </div>
    </div>
  </div>

  <!-- Custom Plan (two sliders + computed essentials) -->
  <h3 class="section-title">Custom Plan</h3>

  <div class="card" id="customCard">
    <div class="slider-title">Invest (%) — <span id="invPctDisplay">30%</span></div>
    <input id="ci" type="range" min="0" max="100" value="30">

    <div class="slider-title">Save (%) — <span id="savPctDisplay">20%</span></div>
    <input id="cs" type="range" min="0" max="100" value="20">

    <div class="slider-title">Essentials (%) — <span id="essPctDisplay">50%</span></div>
    <input id="ce" type="range" min="0" max="100" value="50" disabled style="opacity:0.8;">

    <div style="margin-top:10px">
      <button id="applyCustomBtn">Apply Custom Plan</button>
    </div>
  </div>

  <!-- Output -->
  <h3 class="section-title">Your Breakdown</h3>
  <div class="card">
    <div style="font-weight:700">Invest: <span id="o1">₹0</span></div>
    <div style="font-weight:700;margin-top:6px">Save: <span id="o2">₹0</span></div>
    <div style="font-weight:700;margin-top:6px">Essentials: <span id="o3">₹0</span></div>
  </div>

  <!-- Investing Apps -->
  <h3 class="section-title">Investing Apps</h3>

  <div class="apps">
    <div class="card app-box">
      <div class="app-title">Jar</div>
      <div class="small">Gold savings & daily auto-savings.</div>
      <button class="app-btn" onclick="openApp('https://jar.money')">Open Jar</button>
    </div>

    <div class="card app-box">
      <div class="app-title">Groww</div>
      <div class="small">Mutual funds, SIPs, and stocks.</div>
      <button class="app-btn" onclick="openApp('https://groww.in')">Open Groww</button>
    </div>

    <div class="card app-box">
      <div class="app-title">Zerodha</div>
      <div class="small">Broker & Kite trading platform.</div>
      <button class="app-btn" onclick="openApp('https://zerodha.com')">Open Zerodha</button>
    </div>

    <div class="card app-box">
      <div class="app-title">Angel One</div>
      <div class="small">Brokerage, mutual funds, and more.</div>
      <button class="app-btn" onclick="openApp('https://angelone.in')">Open Angel One</button>
    </div>

    <div class="card app-box">
      <div class="app-title">Upstox</div>
      <div class="small">Discount broker for stocks & derivatives.</div>
      <button class="app-btn" onclick="openApp('https://upstox.com')">Open Upstox</button>
    </div>

    <div class="card app-box">
      <div class="app-title">ET Money</div>
      <div class="small">Mutual funds, insurance, goal SIPs.</div>
      <button class="app-btn" onclick="openApp('https://etmoney.com')">Open ET Money</button>
    </div>
  </div>

</div>

<!-- Inline salary editor (same-page editing) -->
<div class="overlay" id="overlay" onclick="closeSalaryEditor()"></div>
<div class="salary-editor" id="salaryEditor" role="dialog" aria-modal="true">
  <h4>Edit Salary</h4>
  <label class="small" for="salaryInput">Enter monthly salary (numbers only)</label>
  <input id="salaryInput" class="small-input" type="number" min="0" placeholder="e.g. 25000">
  <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
    <button onclick="saveSalary()">Save</button>
    <button onclick="closeSalaryEditor()">Cancel</button>
  </div>
</div>

<script>
/* Utilities */
function openApp(url){ window.open(url,'_blank'); }

/* LOGOUT: go to index.html and clear session data */
function logout(){
  localStorage.removeItem('currentUser');
  localStorage.removeItem('salary');
  // redirect to index.html as requested
  window.location.href = 'index.html';
}

/* Salary display helpers */
function displaySalary(){
  const sd = document.getElementById('salaryDisplay');
  const s = Number(localStorage.getItem('salary')) || 0;
  sd.innerText = s ? '₹' + s.toLocaleString() : 'Not set — use Change Salary';
}

/* OPEN/CLOSE inline salary editor (same page) */
const salaryEditor = document.getElementById('salaryEditor');
const overlay = document.getElementById('overlay');
const salaryInput = document.getElementById('salaryInput');

function openSalaryEditor(){
  // prefill input with current salary if present
  const cur = Number(localStorage.getItem('salary')) || '';
  salaryInput.value = cur ? cur : '';
  overlay.style.display = 'block';
  salaryEditor.style.display = 'block';
  salaryInput.focus();
}

function closeSalaryEditor(){
  overlay.style.display = 'none';
  salaryEditor.style.display = 'none';
  salaryInput.value = '';
}

/* Save salary from inline editor into localStorage and update page */
function saveSalary(){
  const v = Number(salaryInput.value);
  if (isNaN(v) || v < 0){
    alert('Enter a valid salary (number >= 0)');
    return;
  }
  localStorage.setItem('salary', String(Math.round(v)));
  // update display and any live outputs
  displaySalary();
  // if a plan is currently applied, recalc outputs using current slider values
  recalcBreakdownFromUI();
  closeSalaryEditor();
}

/* initial salary display */
displaySalary();

/* Preset apply (unchanged behavior) */
function applyPreset(investPct, savePct, essPct){
  const salary = Number(localStorage.getItem('salary')) || 0;
  if(!salary){ alert('Enter salary first (Change Salary)'); return; }

  const investAmt = Math.round(salary * investPct / 100);
  const saveAmt = Math.round(salary * savePct / 100);
  const essAmt = Math.round(salary * essPct / 100);

  document.getElementById('o1').innerText = '₹' + investAmt.toLocaleString();
  document.getElementById('o2').innerText = '₹' + saveAmt.toLocaleString();
  document.getElementById('o3').innerText = '₹' + essAmt.toLocaleString();

  // Update sliders display to reflect used plan
  document.getElementById('ci').value = investPct;
  document.getElementById('cs').value = savePct;
  document.getElementById('ce').value = essPct;
  document.getElementById('invPctDisplay').innerText = investPct + '%';
  document.getElementById('savPctDisplay').innerText = savePct + '%';
  document.getElementById('essPctDisplay').innerText = essPct + '%';
}

/* Custom plan logic (two sliders: invest & save) */
const ci = document.getElementById('ci');
const cs = document.getElementById('cs');
const ce = document.getElementById('ce');
const invPctDisplay = document.getElementById('invPctDisplay');
const savPctDisplay = document.getElementById('savPctDisplay');
const essPctDisplay = document.getElementById('essPctDisplay');
const applyCustomBtn = document.getElementById('applyCustomBtn');

function refreshCustomDisplays(){
  const a = Number(ci.value);
  let b = Number(cs.value);
  let c = 100 - a - b;
  if(c < 0){
    // fit by reducing the other slider — prefer reducing save (cs) first
    const newB = Math.max(0, 100 - a);
    cs.value = newB;
    b = newB;
    c = 100 - a - b;
  }
  ce.value = c;
  invPctDisplay.innerText = a + '%';
  savPctDisplay.innerText = b + '%';
  essPctDisplay.innerText = c + '%';
}
refreshCustomDisplays();

ci.addEventListener('input', () => { refreshCustomDisplays(); });
cs.addEventListener('input', () => { refreshCustomDisplays(); });

applyCustomBtn.addEventListener('click', () => {
  const salary = Number(localStorage.getItem('salary')) || 0;
  if(!salary){ alert('Enter salary first (Change Salary)'); return; }
  const investPct = Number(ci.value);
  const savePct = Number(cs.value);
  const essPct = Number(ce.value);

  const investAmt = Math.round(salary * investPct / 100);
  const saveAmt = Math.round(salary * savePct / 100);
  const essAmt = Math.round(salary * essPct / 100);

  document.getElementById('o1').innerText = '₹' + investAmt.toLocaleString();
  document.getElementById('o2').innerText = '₹' + saveAmt.toLocaleString();
  document.getElementById('o3').innerText = '₹' + essAmt.toLocaleString();
});

/* Helper to recalc outputs according to current slider values (used after salary edit) */
function recalcBreakdownFromUI(){
  const salary = Number(localStorage.getItem('salary')) || 0;
  if(!salary) return;
  const investPct = Number(ci.value);
  const savePct = Number(cs.value);
  const essPct = Number(ce.value);
  const investAmt = Math.round(salary * investPct / 100);
  const saveAmt = Math.round(salary * savePct / 100);
  const essAmt = Math.round(salary * essPct / 100);

  document.getElementById('o1').innerText = '₹' + investAmt.toLocaleString();
  document.getElementById('o2').innerText = '₹' + saveAmt.toLocaleString();
  document.getElementById('o3').innerText = '₹' + essAmt.toLocaleString();
}

/* If there's an existing salary, recalc initial breakdown once */
recalcBreakdownFromUI();

</script>
</body>
</html>
