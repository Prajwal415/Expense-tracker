<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard — Recommendations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>

<script>
  // require login
  if(!localStorage.getItem('user')) {
    window.location.href = 'auth.html';
  }
</script>

<div class="container">
  <h2>Dashboard</h2>

  <div style="margin-bottom:12px">
    <a class="link" href="salary.html">Change Salary</a> |
    <a class="link" href="add-expense.html">Add Expense</a> |
    <span class="link" onclick="logout()">Logout</span>
  </div>

  <!-- show saved salary -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700">Saved Salary</div>
        <div id="salaryDisplay" class="small">—</div>
      </div>
      <div>
        <button onclick="goToSalary()" class="secondary">Edit Salary</button>
      </div>
    </div>
  </div>

  <!-- Recommendations presets -->
  <h3 class="section-title">Recommendation Plans</h3>

  <div class="card">
    <div style="font-weight:700">Balanced Plan</div>
    <div class="small" style="margin-top:6px">Invest 30% • Save 20% • Essentials 50%</div>
    <div style="margin-top:8px">
      <button onclick="applyPreset(30,20,50)">Use Balanced</button>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:700">Conservative Plan</div>
    <div class="small" style="margin-top:6px">Invest 15% • Save 35% • Essentials 50%</div>
    <div style="margin-top:8px">
      <button onclick="applyPreset(15,35,50)">Use Conservative</button>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:700">Aggressive Plan</div>
    <div class="small" style="margin-top:6px">Invest 45% • Save 10% • Essentials 45%</div>
    <div style="margin-top:8px">
      <button onclick="applyPreset(45,10,45)">Use Aggressive</button>
    </div>
  </div>

  <!-- Custom Plan (two sliders + computed essentials) -->
  <h3 class="section-title">Custom Plan</h3>

  <div class="card" id="customCard">
    <div class="slider-title">Invest (%) — <span id="invPctDisplay">30%</span></div>
    <input id="ci" type="range" min="0" max="100" value="30">

    <div class="slider-title">Save (%) — <span id="savPctDisplay">20%</span></div>
    <input id="cs" type="range" min="0" max="100" value="20">

    <div class="slider-title">Essentials (%) — <span id="essPctDisplay">50%</span></div>
    <input id="ce" type="range" min="0" max="100" value="50" disabled style="opacity:0.8;">

    <button id="applyCustomBtn">Apply Custom Plan</button>
  </div>

  <!-- Output -->
  <h3 class="section-title">Your Breakdown</h3>
  <div class="card">
    <div style="font-weight:700">Invest: <span id="o1">₹0</span></div>
    <div style="font-weight:700;margin-top:6px">Save: <span id="o2">₹0</span></div>
    <div style="font-weight:700;margin-top:6px">Essentials: <span id="o3">₹0</span></div>
  </div>

  <!-- Investing Apps -->
  <h3 class="section-title">Investing Apps</h3>

  <div class="card app-box">
    <div class="app-title">Jar</div>
    <div class="small">Gold savings & daily auto-savings.</div>
    <button class="app-btn" onclick="openApp('https://jar.money')">Open Jar</button>
  </div>

  <div class="card app-box">
    <div class="app-title">Groww</div>
    <div class="small">Mutual funds, SIPs, and stocks.</div>
    <button class="app-btn" onclick="openApp('https://groww.in')">Open Groww</button>
  </div>

  <div class="card app-box">
    <div class="app-title">Zerodha</div>
    <div class="small">Broker & Kite trading platform.</div>
    <button class="app-btn" onclick="openApp('https://zerodha.com')">Open Zerodha</button>
  </div>

  <div class="card app-box">
    <div class="app-title">Angel One</div>
    <div class="small">Brokerage, mutual funds, and more.</div>
    <button class="app-btn" onclick="openApp('https://angelone.in')">Open Angel One</button>
  </div>

  <div class="card app-box">
    <div class="app-title">Upstox</div>
    <div class="small">Discount broker for stocks & derivatives.</div>
    <button class="app-btn" onclick="openApp('https://upstox.com')">Open Upstox</button>
  </div>

  <div class="card app-box">
    <div class="app-title">ET Money</div>
    <div class="small">Mutual funds, insurance, goal SIPs.</div>
    <button class="app-btn" onclick="openApp('https://etmoney.com')">Open ET Money</button>
  </div>

</div>

<script>
/* Utilities */
function goToSalary(){ window.location.href = 'salary.html'; }
function logout(){ localStorage.removeItem('user'); /* keep expenses */ localStorage.removeItem('salary'); window.location.href='auth.html'; }
function openApp(url){ window.open(url,'_blank'); }

/* Salary display */
function displaySalary(){
  const s = Number(localStorage.getItem('salary')) || 0;
  salaryDisplay.innerText = s ? '₹' + s.toLocaleString() : 'Not set — go to Salary page';
}
displaySalary();

/* Preset apply */
function applyPreset(investPct, savePct, essPct){
  const salary = Number(localStorage.getItem('salary')) || 0;
  if(!salary){ alert('Enter salary first (Salary page)'); return; }

  const investAmt = Math.round(salary * investPct / 100);
  const saveAmt = Math.round(salary * savePct / 100);
  const essAmt = Math.round(salary * essPct / 100);

  o1.innerText = '₹' + investAmt.toLocaleString();
  o2.innerText = '₹' + saveAmt.toLocaleString();
  o3.innerText = '₹' + essAmt.toLocaleString();

  // Update sliders display to reflect used plan
  ci.value = investPct; cs.value = savePct;
  ce.value = essPct;
  invPctDisplay.innerText = investPct + '%';
  savPctDisplay.innerText = savePct + '%';
  essPctDisplay.innerText = essPct + '%';
}

/* Custom plan logic (two sliders: invest & save) */
const ci = document.getElementById('ci');
const cs = document.getElementById('cs');
const ce = document.getElementById('ce');
const invPctDisplay = document.getElementById('invPctDisplay');
const savPctDisplay = document.getElementById('savPctDisplay');
const essPctDisplay = document.getElementById('essPctDisplay');
const applyCustomBtn = document.getElementById('applyCustomBtn');

function refreshCustomDisplays(){
  const a = Number(ci.value);
  const b = Number(cs.value);
  let c = 100 - a - b;
  if(c < 0){
    // fit by reducing the other slider
    // prefer reducing save (cs) first
    const newB = Math.max(0, 100 - a);
    cs.value = newB;
    c = 100 - a - newB;
  }
  ce.value = c;
  invPctDisplay.innerText = a + '%';
  savPctDisplay.innerText = Number(cs.value) + '%';
  essPctDisplay.innerText = c + '%';
}
refreshCustomDisplays();

ci.addEventListener('input', () => { refreshCustomDisplays(); });
cs.addEventListener('input', () => { refreshCustomDisplays(); });

applyCustomBtn.addEventListener('click', () => {
  const salary = Number(localStorage.getItem('salary')) || 0;
  if(!salary){ alert('Enter salary first (Salary page)'); return; }
  const investPct = Number(ci.value);
  const savePct = Number(cs.value);
  const essPct = Number(ce.value);

  const investAmt = Math.round(salary * investPct / 100);
  const saveAmt = Math.round(salary * savePct / 100);
  const essAmt = Math.round(salary * essPct / 100);

  o1.innerText = '₹' + investAmt.toLocaleString();
  o2.innerText = '₹' + saveAmt.toLocaleString();
  o3.innerText = '₹' + essAmt.toLocaleString();
});

</script>
</body>
</html>
